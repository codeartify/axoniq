<div class="p-5 max-w-7xl mx-auto">
  @if (isLoading()) {
    <div class="text-center py-10 text-gray-500 text-lg">Loading product...</div>
  }

  @if (errorMessage()) {
    <div class="p-4 mb-4 bg-red-100 border border-red-400 text-red-700 rounded">
      {{ errorMessage() }}
    </div>
  }

  @if (successMessage()) {
    <div class="p-4 mb-4 bg-green-100 border border-green-400 text-green-700 rounded">
      {{ successMessage() }}
    </div>
  }

  @if (!isLoading() && product()) {
    <div class="bg-white shadow-md rounded-lg p-6">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold text-gray-800">{{ isEditing() ? 'Edit Product' : 'Product Details' }}</h2>
        <div class="flex gap-2">
          @if (!isEditing()) {
            <button (click)="startEdit()" class="px-4 py-2 bg-blue-500 text-white rounded border-none cursor-pointer text-sm font-medium hover:bg-blue-600 transition-colors">Edit</button>
          }
          <button (click)="goBack()" class="px-4 py-2 bg-gray-500 text-white rounded border-none cursor-pointer text-sm font-medium hover:bg-gray-600 transition-colors">Back to List</button>
        </div>
      </div>

      @if (!isEditing()) {
        <div>
          <div class="mb-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Basic Information</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Product Code:</label>
                <span class="text-gray-800">{{ product()!.code }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Product Name:</label>
                <span class="text-gray-800">{{ product()!.name }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Product Type:</label>
                <span class="text-gray-800">{{ product()!.productType }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Price:</label>
                <span class="text-gray-800">{{ product()!.price | currency }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Audience:</label>
                <span class="text-gray-800">{{ product()!.audience }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Requires Membership:</label>
                <span class="text-gray-800">{{ product()!.requiresMembership ? 'Yes' : 'No' }}</span>
              </div>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Behavior Configuration</h3>
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Time Based:</label>
                <span class="text-gray-800">{{ product()!.behavior.isTimeBased ? 'Yes' : 'No' }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Session Based:</label>
                <span class="text-gray-800">{{ product()!.behavior.isSessionBased ? 'Yes' : 'No' }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Can Be Paused:</label>
                <span class="text-gray-800">{{ product()!.behavior.canBePaused ? 'Yes' : 'No' }}</span>
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Auto Renew:</label>
                <span class="text-gray-800">{{ product()!.behavior.autoRenew ? 'Yes' : 'No' }}</span>
              </div>
              @if (product()!.behavior.renewalLeadTimeDays) {
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Renewal Lead Time:</label>
                  <span class="text-gray-800">{{ product()!.behavior.renewalLeadTimeDays }} days</span>
                </div>
              }
              <div>
                <label class="block text-sm font-medium text-gray-600 mb-1">Contributes to Membership:</label>
                <span class="text-gray-800">{{ product()!.behavior.contributesToMembershipStatus ? 'Yes' : 'No' }}</span>
              </div>
              @if (product()!.behavior.maxActivePerCustomer) {
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Max Active Per Customer:</label>
                  <span class="text-gray-800">{{ product()!.behavior.maxActivePerCustomer }}</span>
                </div>
              }
              @if (product()!.behavior.exclusivityGroup) {
                <div>
                  <label class="block text-sm font-medium text-gray-600 mb-1">Exclusivity Group:</label>
                  <span class="text-gray-800">{{ product()!.behavior.exclusivityGroup }}</span>
                </div>
              }
            </div>
          </div>
        </div>
      } @else {
        <form (ngSubmit)="saveProduct()">
          <div class="mb-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Basic Information</h3>

            <div class="mb-4">
              <label for="code" class="block text-sm font-medium text-gray-700 mb-1">Product Code *</label>
              <input
                type="text"
                id="code"
                [(ngModel)]="editedProduct!.code"
                name="code"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Product Name *</label>
              <input
                type="text"
                id="name"
                [(ngModel)]="editedProduct!.name"
                name="name"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="productType" class="block text-sm font-medium text-gray-700 mb-1">Product Type *</label>
              <input
                type="text"
                id="productType"
                [(ngModel)]="editedProduct!.productType"
                name="productType"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="price" class="block text-sm font-medium text-gray-700 mb-1">Price *</label>
              <input
                type="number"
                id="price"
                [(ngModel)]="editedProduct!.price"
                name="price"
                required
                min="0"
                step="0.01"
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="audience" class="block text-sm font-medium text-gray-700 mb-1">Audience *</label>
              <select
                id="audience"
                [(ngModel)]="editedProduct!.audience"
                name="audience"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              >
                @for (aud of audiences; track aud) {
                  <option [value]="aud">{{ aud }}</option>
                }
              </select>
            </div>

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.requiresMembership"
                  name="requiresMembership"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Requires Membership</span>
              </label>
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">Behavior Configuration</h3>

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.behavior.isTimeBased"
                  name="isTimeBased"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Time Based</span>
              </label>
            </div>

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.behavior.isSessionBased"
                  name="isSessionBased"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Session Based</span>
              </label>
            </div>

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.behavior.canBePaused"
                  name="canBePaused"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Can Be Paused</span>
              </label>
            </div>

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.behavior.autoRenew"
                  name="autoRenew"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Auto Renew</span>
              </label>
            </div>

            @if (editedProduct!.behavior.autoRenew) {
              <div class="mb-4">
                <label for="renewalLeadTimeDays" class="block text-sm font-medium text-gray-700 mb-1">Renewal Lead Time (Days)</label>
                <input
                  type="number"
                  id="renewalLeadTimeDays"
                  [(ngModel)]="editedProduct!.behavior.renewalLeadTimeDays"
                  name="renewalLeadTimeDays"
                  min="0"
                  class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>
            }

            <div class="mb-4 flex items-center">
              <label class="flex items-center cursor-pointer">
                <input
                  type="checkbox"
                  [(ngModel)]="editedProduct!.behavior.contributesToMembershipStatus"
                  name="contributesToMembershipStatus"
                  class="mr-2 h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500"
                />
                <span class="text-sm font-medium text-gray-700">Contributes to Membership Status</span>
              </label>
            </div>

            <div class="mb-4">
              <label for="maxActivePerCustomer" class="block text-sm font-medium text-gray-700 mb-1">Max Active Per Customer</label>
              <input
                type="number"
                id="maxActivePerCustomer"
                [(ngModel)]="editedProduct!.behavior.maxActivePerCustomer"
                name="maxActivePerCustomer"
                min="0"
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>

            <div class="mb-4">
              <label for="exclusivityGroup" class="block text-sm font-medium text-gray-700 mb-1">Exclusivity Group</label>
              <input
                type="text"
                id="exclusivityGroup"
                [(ngModel)]="editedProduct!.behavior.exclusivityGroup"
                name="exclusivityGroup"
                class="w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
          </div>

          <div class="flex justify-end gap-3">
            <button
              type="button"
              (click)="cancelEdit()"
              class="px-4 py-2 bg-gray-500 text-white rounded border-none cursor-pointer text-sm font-medium hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              [disabled]="isSaving()"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="px-4 py-2 bg-blue-500 text-white rounded border-none cursor-pointer text-sm font-medium hover:bg-blue-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
              [disabled]="isSaving()"
            >
              {{ isSaving() ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      }
    </div>
  }
</div>
